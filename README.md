# JER1Suite

这是一个基于Electron的跨平台GUI应用程序，用于控制JER1设备。该应用提供了直观的用户界面，可以轻松配置和控制设备的各种参数和功能。

## 功能特点

- **串口通信**：自动检测可用串口，支持多种波特率
- **电机控制**：精确控制两个电机的PWM值（-100%至+100%）
- **参数配置**：
  - PWM频率调节（低频/正常/中频/高频）
  - 旋转方向控制（双向/单向/舵机模式/喇叭模式）
  - 衰减模式设置（快速/慢速）
  - 混控模式设置（禁用/启用/步进电机模式）
  - 输入信号模式（USART或PWM/仅USART/USART或ADC）
- **设备管理**：支持多设备总线控制（最多15个设备）
- **实时监控**：通信日志实时显示，便于调试
- **紧急停止**：一键停止所有电机运行

## 安装指南

### 系统要求

- Windows 7或更高版本
- macOS 10.11或更高版本
- Linux（Ubuntu 16.04或更高版本）

### 从源代码构建

1. 确保已安装Node.js（推荐v16或更高版本）

2. 克隆仓库并安装依赖：

```bash
git clone https://github.com/aerror2/JER1Suite.git
cd  JER1Suite
npm install
```

3. 启动应用：

```bash
npm start
```

4. 构建可执行文件：

```bash
# Windows
npm run build:win

# macOS
npm run build:mac

# Linux
npm run build:linux
```

## 使用说明

### 连接设备

1. 启动应用程序
2. 在左侧面板中选择正确的串口和波特率（默认115200）
3. 点击"连接"按钮
4. 连接成功后，状态指示器将变为绿色

### 控制电机

- 使用滑块调节电机速度和方向
- 使用预设按钮快速设置常用速度
- 紧急情况下，点击"紧急停止"按钮立即停止所有电机

### 配置参数

1. 在中间面板中选择所需的参数设置
2. 点击对应的"应用"按钮将设置发送到设备

## 通信协议

应用使用以下命令格式与设备通信：

```
命令格式: 0x55 + 命令类型 + 参数1 + 参数2 + 校验和
校验和 = 命令类型 + 参数1 + 参数2
```

### 主要命令

#### 基本命令
- `0x0F`: Host连接指令
- `0x01`: Host写入配置
- `0x02`: Host保存设置
- `0x03`: Host启动电机
- `0x04`: 设置全部回到默认
- `0x05`: 重启设备
- `0x06`: Host设置PWM1, PWM2
- `0x07`: 设置设备ID（用于总线识别，1-15特定设备，0表示全部）
- `0x08`: 查询设备参数

#### 功能命令
- `0x01`: 频率设置
- `0x02`: 衰减模式设置
- `0x03`: 混控模式设置
- `0x04`: 旋转方向设置
- `0x05`: 输入信号设置

### 参数定义

#### PWM频率参数
- `0x01`: 低频（约75Hz）
- `0x02`: 正常（约150Hz）
- `0x03`: 中频（约500Hz）
- `0x04`: 高频（约1000Hz）

#### 旋转方向参数
- `0x01`: 双向模式
- `0x02`: 单向模式
- `0x03`: 舵机模式
- `0x04`: 喇叭模式（S1汽车鸣笛，S2警笛）

#### 衰减模式参数
- `0x01`: 快速衰减（步进电机四拍/MOS衰减）
- `0x02`: 慢速衰减（步进电机八拍/电机衰减）

#### 混控模式参数
- `0x01`: 禁用混控
- `0x02`: 启用混控
- `0x03`: 步进电机模式

#### 输入信号参数
- `0x01`: USART或PWM
- `0x02`: 仅USART
- `0x03`: USART或ADC

### 命令示例

```javascript
// 设置PWM频率为高频
const command = [0x55, 0x01, 0x01, 0x04, 0x06]; // 0x55 + FUNC_FREQ + PARAM_FREQ_HIGH + 校验和

// 设置电机PWM值
const pwmCommand = [0x55, 0x06, pwm1Value, pwm2Value, checksum];

// 连接设备
const connectCommand = [0x55, 0x0F, 0x00, 0x00, 0x0F];
```

## 故障排除

### 无法连接设备

- 确认设备已正确连接到计算机
- 验证选择了正确的串口和波特率
- 检查设备驱动是否正确安装
- 尝试重新插拔USB连接
- 检查设备ID设置是否正确

### 电机不响应命令

- 检查连接状态是否正常
- 确认电机电源是否接通
- 尝试重置设备（发送重启命令）
- 检查通信日志中是否有错误信息
- 验证命令格式和校验和是否正确

### 多设备通信问题

- 确认每个设备的ID设置唯一（1-15）
- 检查总线连接是否正常
- 使用设备ID 0 进行广播测试
- 逐个设备测试连接

## 开发者信息

### 项目结构

- `main.js`: Electron主进程
- `preload.js`: 预加载脚本，提供安全的IPC通信和协议定义
- `renderer.js`: 渲染进程，处理UI交互
- `serial.js`: 串口通信管理
- `protocol.js`: 通信协议处理
- `index.html`: 主界面
- `styles.css`: 样式表

### 技术栈

- Electron: 跨平台桌面应用框架
- SerialPort: Node.js串口通信库
- HTML/CSS/JavaScript: 前端界面

### 协议实现

协议相关的常量和函数定义在 `preload.js` 中：
- `COMMANDS`: 包含所有命令和参数的常量定义
- `formatCommand()`: 命令格式化函数，自动计算校验和

## 许可证

本项目采用MIT许可证。详情请参阅LICENSE文件。
